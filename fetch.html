<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Student Management System</title>
<style>
body { font-family: Arial; background: #f2f2f2; padding: 20px; }
button { padding: 8px 12px; background: #a853a4; color: white; border: none; margin: 4px; cursor: pointer; }
button.delete { background: #d9534f; }
table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
th { background: #a853a4; color: white; }
.modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.4); }
.modal-content { background: white; width: 400px; margin: 80px auto; padding: 20px; border-radius: 6px; }
input, select { width: 95%; padding: 8px; margin: 6px 0; display: block; border: 1px solid #ccc; border-radius: 4px; }
input.invalid, select.invalid { border-color: red; }
.error { color: red; font-size: 12px; margin: 2px 0 6px 0; }
</style>
</head>
<body>

<h2>Student Management System</h2>
<button onclick="openForm()">Add Student</button>

<table>
<thead>
<tr>
<th>Name</th><th>Semester</th><th>Department</th>
<th>Father</th><th>Father Mobile</th>
<th>Mother</th><th>Mother Mobile</th>
<th>Address</th><th>Actions</th>
</tr>
</thead>
<tbody id="table"></tbody>
</table>

<div class="modal" id="modal">
<div class="modal-content">
<form id="form">

<input id="name" placeholder="Student Name">
<span class="error" id="nameError"></span>

<select id="semester">
<option value="">Semester</option>
<option>1</option><option>2</option><option>3</option>
<option>4</option><option>5</option><option>6</option>
</select>
<span class="error" id="semesterError"></span>

<select id="department">
<option value="">Department</option>
<option>CSE</option><option>EEE</option><option>AET</option>
</select>
<span class="error" id="departmentError"></span>

<input id="father" placeholder="Father Name">
<span class="error" id="fatherError"></span>

<input id="fatherMobile" placeholder="Father Mobile">
<span class="error" id="fatherMobileError"></span>

<input id="mother" placeholder="Mother Name">
<span class="error" id="motherError"></span>

<input id="motherMobile" placeholder="Mother Mobile">
<span class="error" id="motherMobileError"></span>

<input id="address" placeholder="Address">
<span class="error" id="addressError"></span>

<button type="submit">Save</button>
<button type="button" class="delete" onclick="closeForm()">Cancel</button>
</form>
</div>
</div>

<script>
const API = "https://695201a33b3c518fca112cf3.mockapi.io/students";
let editId = null;

const modal = document.getElementById("modal");
const table = document.getElementById("table");
const form = document.getElementById("form");

function openForm() { modal.style.display = "block"; clearErrors(); }
function closeForm() { modal.style.display = "none"; form.reset(); editId = null; clearErrors(); }
function clearErrors() { 
    document.querySelectorAll(".error").forEach(e => e.textContent = "");
    document.querySelectorAll("input, select").forEach(e => e.classList.remove("invalid"));
}

async function loadStudents() {
    try {
        const res = await fetch(API);
        const students = await res.json();
        table.innerHTML = "";
        students.forEach(s => {
            table.innerHTML += `
            <tr>
                <td>${s.name}</td>
                <td>${s.semester}</td>
                <td>${s.department}</td>
                <td>${s.father}</td>
                <td>${s.fatherMobile}</td>
                <td>${s.mother}</td>
                <td>${s.motherMobile}</td>
                <td>${s.address}</td>
                <td>
                    <button onclick="startEdit('${s.id}')">Edit</button>
                    <button class="delete" onclick="removeStudent('${s.id}')">Delete</button>
                </td>
            </tr>`;
        });
    } catch (err) {
        console.error(err);
    }
}

form.addEventListener("submit", async e => {
    e.preventDefault();
    clearErrors();

    const student = {
        name: document.getElementById("name").value.trim(),
        semester: document.getElementById("semester").value,
        department: document.getElementById("department").value,
        father: document.getElementById("father").value.trim(),
        fatherMobile: document.getElementById("fatherMobile").value.trim(),
        mother: document.getElementById("mother").value.trim(),
        motherMobile: document.getElementById("motherMobile").value.trim(),
        address: document.getElementById("address").value.trim()
    };

    let valid = true;

    // Mandatory fields
    if (!student.name) { 
        document.getElementById("nameError").textContent = "Name is required"; 
        document.getElementById("name").classList.add("invalid");
        valid = false; 
    }
    if (!student.semester) { 
        document.getElementById("semesterError").textContent = "Semester is required"; 
        document.getElementById("semester").classList.add("invalid");
        valid = false; 
    }
    if (!student.department) { 
        document.getElementById("departmentError").textContent = "Department is required"; 
        document.getElementById("department").classList.add("invalid");
        valid = false; 
    }
    if (!student.address) { 
        document.getElementById("addressError").textContent = "Address is required"; 
        document.getElementById("address").classList.add("invalid");
        valid = false; 
    }

    // Optional: mobile validation only if filled
    if (student.fatherMobile && !/^\d{10}$/.test(student.fatherMobile)) {
        document.getElementById("fatherMobileError").textContent = "Father Mobile must be 10 digits"; 
        document.getElementById("fatherMobile").classList.add("invalid");
        valid = false;
    }
    if (student.motherMobile && !/^\d{10}$/.test(student.motherMobile)) {
        document.getElementById("motherMobileError").textContent = "Mother Mobile must be 10 digits"; 
        document.getElementById("motherMobile").classList.add("invalid");
        valid = false;
    }

    if (!valid) return;

    try {
        if (editId) {
            await fetch(`${API}/${editId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(student)
            });
        } else {
            await fetch(API, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(student)
            });
        }
        closeForm();
        loadStudents();
    } catch (err) {
        console.error(err);
    }
});

async function startEdit(id) {
    try {
        const res = await fetch(`${API}/${id}`);
        const s = await res.json();
        editId = s.id;
        document.getElementById("name").value = s.name;
        document.getElementById("semester").value = s.semester;
        document.getElementById("department").value = s.department;
        document.getElementById("father").value = s.father;
        document.getElementById("fatherMobile").value = s.fatherMobile;
        document.getElementById("mother").value = s.mother;
        document.getElementById("motherMobile").value = s.motherMobile;
        document.getElementById("address").value = s.address;
        openForm();
    } catch (err) { console.error(err); }
}

async function removeStudent(id) {
    if (confirm("Delete this student?")) {
        try {
            await fetch(`${API}/${id}`, { method: "DELETE" });
            loadStudents();
        } catch (err) { console.error(err); }
    }
}

loadStudents();
</script>

</body>
</html>
